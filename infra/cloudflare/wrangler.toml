name = "claim-storage"
main = "src/index.ts"
compatibility_date = "2024-01-01"

[env.development]
name = "claim-storage-dev"

[[env.development.r2_buckets]]
binding = "MATCHES_BUCKET"
bucket_name = "claim-matches-test"  # Test bucket for development

[[env.development.durable_objects.bindings]]
name = "MATCH_COORDINATOR"
class_name = "MatchCoordinatorDO"
script_name = "claim-storage-dev"

[[env.development.migrations]]
tag = "v1"
new_sqlite_classes = ["MatchCoordinatorDO"]

[env.development.vars]
ENVIRONMENT = "development"
BUCKET_NAME = "claim-matches-test"  # Test bucket name for safety checks
# Development: Allow all origins (*) for local testing (localhost, etc.)
# Production: Must use specific origin (https://game.ocentra.ca)
CORS_ORIGIN = "*"  # Allows localhost:5173, localhost:3000, etc. for local dev
# Rate limiting: Higher limit for testing (1000/hour to avoid test failures)
RATE_LIMIT_MATCHES_PER_HOUR = "1000"
# Signed URL secret for testing (required for signed URL tests)
SIGNED_URL_SECRET = "test-secret-key-for-development-only-change-in-production"

[env.production]
name = "claim-storage"

[[env.production.r2_buckets]]
binding = "MATCHES_BUCKET"
bucket_name = "claim-matches"  # Production bucket

[[env.production.durable_objects.bindings]]
name = "MATCH_COORDINATOR"
class_name = "MatchCoordinatorDO"
script_name = "claim-storage"

[[env.production.migrations]]
tag = "v1"
new_sqlite_classes = ["MatchCoordinatorDO"]

[env.production.vars]
ENVIRONMENT = "production"
# Per critique Issue #12: Reject * in production for security
# Production domain: https://game.ocentra.ca
CORS_ORIGIN = "https://game.ocentra.ca"
# Rate limiting: 100 matches per hour per IP/wallet (production-friendly)
# Can be increased if needed: RATE_LIMIT_MATCHES_PER_HOUR = "500"
# RATE_LIMIT_MATCHES_PER_HOUR = "100"

